import{j as o,i as c,k as n,L as e,o as g}from"./vidstack-a8b42906.js";import{a as d,N as m,a0 as p,e as b,o as f,l as h,D as l,a1 as y,n as k,h as $}from"./vidstack-a0a104b8.js";class u{constructor(t){this.N=t}D(){d(this.kb)&&this.lb()}E(){m(this.kb)&&window.cancelAnimationFrame(this.kb),this.kb=void 0}lb(){this.kb=window.requestAnimationFrame(()=>{d(this.kb)||(this.N(),this.lb())})}}class _{constructor(t,i){this.da=p(),this.ba=!1,this.ea=!1,this.fa=!1,this.ca=new u(this.la.bind(this)),this.ja=void 0,this.Ia=void 0,this.ga=t,this.l=i,this.ma(),b(this.na.bind(this)),f(this.Q.bind(this))}get i(){return this.ga.media}get _(){return this.l.delegate}Q(){this.ea=!1,this.fa=!1,this.ca.E(),this.da.empty()}la(){const t=this.ga.currentTime;this.l.$state.currentTime()!==t&&this.aa(t)}ma(){this.$("loadstart",this.K),this.$("abort",this.ia),this.$("emptied",this.oa),this.$("error",this.p)}pa(){this.ea||(this.da.add(this.$("loadeddata",this.qa),this.$("loadedmetadata",this.ra),this.$("canplay",this.sa),this.$("canplaythrough",this.ta),this.$("durationchange",this.ua),this.$("play",this.va),this.$("progress",this.wa),this.$("stalled",this.xa),this.$("suspend",this.ya)),this.ea=!0)}za(){this.fa||(this.da.add(this.$("pause",this.Aa),this.$("playing",this.Ba),this.$("ratechange",this.Ca),this.$("seeked",this.Da),this.$("seeking",this.Ea),this.$("ended",this.Fa),this.$("volumechange",this.Ga),this.$("waiting",this.Ha)),this.fa=!0)}$(t,i){return h(this.i,t,i.bind(this))}Ja(t){}aa(t,i){this._.f("time-update",{detail:{currentTime:Math.min(t,this.l.$state.seekableEnd()),played:this.i.played},trigger:i})}K(t){if(this.i.networkState===3){this.ia(t);return}this.pa(),this._.f("load-start",{trigger:t})}ia(t){this._.f("abort",{trigger:t})}oa(){this._.f("emptied",{trigger:event})}qa(t){this._.f("loaded-data",{trigger:t})}ra(t){this.ka(),this.za(),this._.f("volume-change",{detail:{volume:this.i.volume,muted:this.i.muted}}),this._.f("loaded-metadata",{trigger:t}),o&&c(this.l.$state.source())&&this._.Ka(this.ha(),t)}ha(){return{duration:this.i.duration,buffered:this.i.buffered,seekable:this.i.seekable}}ka(){if(this.l.$state.live())return;const t=!Number.isFinite(this.i.duration);this._.f("stream-type-change",{detail:t?"live":"on-demand"})}va(t){this.l.$state.canPlay&&this._.f("play",{trigger:t})}Aa(t){this.i.readyState===1&&!this.ba||(this.ba=!1,this.ca.E(),this._.f("pause",{trigger:t}))}sa(t){this.ka(),this._.Ka(this.ha(),t)}ta(t){this.l.$state.started()||this._.f("can-play-through",{trigger:t,detail:this.ha()})}Ba(t){this.ba=!1,this._.f("playing",{trigger:t}),this.ca.D()}xa(t){this._.f("stalled",{trigger:t}),this.i.readyState<3&&(this.ba=!0,this._.f("waiting",{trigger:t}))}Ha(t){this.i.readyState<3&&(this.ba=!0,this._.f("waiting",{trigger:t}))}Fa(t){this.ca.E(),this.aa(this.i.duration,t),this._.f("end",{trigger:t}),this.l.$state.loop()?this.La():this._.f("ended",{trigger:t})}na(){this.l.$state.paused()&&h(this.i,"timeupdate",this.Ma.bind(this))}Ma(t){this.aa(this.i.currentTime,t)}ua(t){this.l.$state.ended()&&this.aa(this.i.duration,t),this._.f("duration-change",{detail:this.i.duration,trigger:t})}Ga(t){this._.f("volume-change",{detail:{volume:this.i.volume,muted:this.i.muted},trigger:t})}Da(t){this.aa(this.i.currentTime,t),this._.f("seeked",{detail:this.i.currentTime,trigger:t}),Math.trunc(this.i.currentTime)===Math.trunc(this.i.duration)&&n(this.i.duration)>n(this.i.currentTime)&&(this.aa(this.i.duration,t),this.i.ended||this.l.player.dispatch(new l("media-play-request",{trigger:t})))}Ea(t){this._.f("seeking",{detail:this.i.currentTime,trigger:t})}wa(t){this._.f("progress",{detail:{buffered:this.i.buffered,seekable:this.i.seekable},trigger:t})}La(){y(this.i.controls)&&(this.i.controls=!1),this.l.player.dispatch(new l("media-loop-request"))}ya(t){this._.f("suspend",{trigger:t})}Ca(t){this._.f("rate-change",{detail:this.i.playbackRate,trigger:t})}p(t){const i=this.i.error;i&&this._.f("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class T{constructor(t,i){this.ga=t,this.O=i,this.Na.onaddtrack=this.Pa.bind(this),this.Na.onremovetrack=this.Qa.bind(this),this.Na.onchange=this.Ra.bind(this),h(this.O.audioTracks,"change",this.Sa.bind(this))}get Na(){return this.ga.media.audioTracks}Pa(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.O.audioTracks[e.C](s,t),i.enabled&&(s.selected=!0)}Qa(t){const i=this.O.audioTracks.getById(t.track.id);i&&this.O.audioTracks[e.Ta](i,t)}Ra(t){let i=this.Oa();if(!i)return;const s=this.O.audioTracks.getById(i.id);s&&this.O.audioTracks[e.B](s,!0,t)}Oa(){return Array.from(this.Na).find(t=>t.enabled)}Sa(t){const{current:i}=t.detail;if(!i)return;const s=this.Na.getTrackById(i.id);if(s){const r=this.Oa();r&&(r.enabled=!1),s.enabled=!0}}}class v{constructor(t){this.j=null,this.i=t}setup(t){new _(this,t),"audioTracks"in this.media&&new T(this,t),this.playsinline=t.$state.playsinline()}get type(){return""}get media(){return this.i}get currentSrc(){return this.j}get paused(){return this.i.paused}get muted(){return this.i.muted}set muted(t){this.i.muted=t}get volume(){return this.i.volume}set volume(t){this.i.volume=t}get currentTime(){return this.i.currentTime}set currentTime(t){this.i.currentTime=t}get playsinline(){return this.i.hasAttribute("playsinline")}set playsinline(t){k(this.i,"playsinline",t)}get playbackRate(){return this.i.playbackRate}set playbackRate(t){this.i.playbackRate=t}async play(){return this.i.play()}async pause(){return this.i.pause()}async loadSource({src:t,type:i},s){this.i.preload=s,g(t)?this.i.srcObject=t:(this.i.srcObject=null,this.i.src=$(t)?t:window.URL.createObjectURL(t)),this.i.load(),this.j={src:t,type:i}}}export{v as H,u as R};
